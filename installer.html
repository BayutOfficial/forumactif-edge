<style type="text/css">#fae_cp { font-size:12px; font-family:"Roboto", "Helvetica Neue", Helvetica, Arial, sans-serif; padding:3px; }
#fae_cp_main_title { font-size:24px; margin:6px 0; }
#fae_cp .fae_cp_title { color:#FFF; font-size:16px; background:#69C; padding:6px 3px; margin:6px 0; }
#fae_actions input { color:#FFF; background:#69C; border:none; padding:6px 9px; cursor:pointer; }
#fae_actions input:hover { background:#58B; }
#fae_log { background:#EEE; border:1px solid #CCC; height:150px; margin:6px 0; overflow-y:auto; }
#fae_progress { background:#CCC; height:30px; width:100%; position:relative; }
#fae_prog_bar { height:30px; background:#69C; width:0%; }
#fae_prog_number { color:#FFF; font-size:16px; line-height:30px; font-family:Arial; text-align:center; position:absolute; left:0; right:0; top:0; bottom:0; }
.fae_msg_log { margin:3px; }</style>

<div id="fae_cp">
  <h1 id="fae_cp_main_title">Forumactif Edge Control Panel</h1>
  <p id="fae_cp_desc">This panel allows you to install, uninstall, and update <a href="https://github.com/SethClydesdale/forumactif-edge" target="_blank">Forumactif Edge</a>. Get ready to experience your forum in a more modern and responsive way!</p>

  <h3 class="fae_cp_title">Log</h3>
  <div id="fae_log"></div>
  <div id="fae_progress"></div>

  <div id="fae_actions" style="display:none;">
    <h3 class="fae_cp_title">Actions</h3>
    <div id="fae_options">
      <input id="fae_install" type="button" value="Install" />
      <input id="fae_uninstall" type="button" value="Uninstall" style="display:none;" />
      <input id="fae_update" type="button" value="Check for updates" style="display:none;" />
    </div>
  </div>
</div>

<script type="text/javascript">//<![CDATA[
(function() {
  window.FAE = {
    logger : document.getElementById('fae_log'),
    log : function(str, css) {
      FAE.logger.insertAdjacentHTML('beforeend', '<div class="fae_msg_log" ' + (css ? 'style="' + css + '"' : '') + '>' + str + '</div>');
      FAE.logger.scrollTop = 99999;
    },


    bar : document.getElementById('fae_progress'),
    progress : function() {
      var percent = (FAE.index / FAE.quota * 100).toFixed(2);
      FAE.bar.innerHTML = '<div id="fae_prog_bar" style="width:' + percent + '%;"></div><span id="fae_prog_number">' + (percent == 100 ? 'INSTALL COMPLETE' : percent + '%') + '</span>';
    }

  };

  // stuff that needs to be executed when the doc is ready
  $(function() {
    var admin = $('a[href^="/admin/"]')[0], // get the AP link so we can fetch the TID
        installed = document.getElementById('fa_edge');

    // only allow the founder to install the theme
    if (_userdata.user_id == 1 && admin) {
      FAE.tid = admin.href.replace(/.*?(&tid=.*)/, '$1'); // cache the tid
      document.getElementById('fae_actions').style.display = 'block';

      // Installation initialization
      document.getElementById('fae_install').onclick = function() {
        if (confirm('Are you sure you want to ' + ( installed ? 're' : '' ) + 'install Forumactif Edge? This will overwrite your current theme and delete your current JavaScripts. \\\n\\\nPlease make sure to backup all your personal content files such as CSS, Templates, and JavaScripts before proceeding. Click "Cancel" if you\'re not ready to install Forumactif Edge.'.replace(/\\/g, ''))) {

          $.get('https://raw.githubusercontent.com/SethClydesdale/forumactif-edge/master/javascripts/install.js', function(d) {
            var script = document.createElement('SCRIPT');
            script.type = 'text/javascript';
            script.text = d;
            document.body.appendChild(script);
            FAE.next();
          });

          document.getElementById('fae_options').style.display = 'none';
        }
      };

      // extra actions for when the theme is installed.
      if (installed) {
        var uninstall = document.getElementById('fae_uninstall'),
            update = document.getElementById('fae_update');

        document.getElementById('fae_install').value = 'Reinstall';

        $([uninstall, update]).show();

        // Uninstallation initialization
        uninstall.onclick = function() {
          if (confirm('Are you sure you want to uninstall Forumactif Edge? All CSS, JavaScript, and Template changes will be deleted ; The forum will be reverted to the default phpbb3 theme. \\\n\\\nPlease make sure to backup all your personal content files such as CSS, Templates, and JavaScripts before proceeding. Click "Cancel" if you don\'t want to uninstall Forumactif Edge yet.'.replace(/\\/g, ''))) {

            $.get('https://raw.githubusercontent.com/SethClydesdale/forumactif-edge/master/javascripts/uninstall.js', function(d) {
              var script = document.createElement('SCRIPT');
              script.type = 'text/javascript';
              script.text = d;
              document.body.appendChild(script);
              FAE.next();
            });

            document.getElementById('fae_options').style.display = 'none';
          }
        };

        // Check for updates (INCOMPLETE)
        update.onclick = function() {
          FAE.log('Checking for updates on Github...');
        };
      }

    } else {
      FAE.log('Only <a href="/u1">the founder</a> may use this control panel. Please contact them for assistance in installing Forumactif Edge.', 'color:#E53;font-weight:bold;');
    }
  });
}());
//]]></script>
